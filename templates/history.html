{% extends "layout.html" %}
{% set title = "Skinalyze — Historique" %}

{% block content %}
<div style="max-width:980px;margin:0 auto;padding:28px 18px;">

  <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:18px;">
    <h2 style="margin:0;">Historique des chats</h2>

    <form method="POST" action="/history/clear"
          onsubmit="return confirm('Vider tout l’historique ?');">
      <button type="submit" class="lander-btn" style="height:44px;padding:0 18px;">
        Vider l’historique
      </button>
    </form>
  </div>

  {% if chats and chats|length > 0 %}
    <div style="display:flex;flex-direction:column;gap:14px;">
      {% for c in chats %}
        <div style="display:flex;gap:12px;align-items:center;border:2px solid #111;border-radius:16px;padding:12px;">

          <a href="/chat/{{ c.id }}"
             style="display:flex;gap:12px;align-items:center;flex:1;text-decoration:none;color:#111;">
            <div style="width:96px;height:62px;border:2px solid #111;border-radius:12px;overflow:hidden;background:#fff;">
              <img src="/uploads/{{ c.image_filename }}" alt="photo"
                   style="width:100%;height:100%;object-fit:cover;display:block;">
            </div>

            <div style="display:flex;flex-direction:column;gap:6px;">
              <div style="font-size:13px;opacity:.75;">{{ c.created_at }}</div>
              <div style="font-size:14px;">
                {{ (c.note or "Sans message")[:60] }}{% if (c.note or "")|length > 60 %}…{% endif %}
              </div>
            </div>
          </a>

          <form method="POST" action="/chat/{{ c.id }}/delete"
                onsubmit="return confirm('Supprimer ce chat ?');">
            <button type="submit"
              style="width:44px;height:44px;border-radius:14px;border:2px solid #111;background:#fff;cursor:pointer;font-size:18px;">
              ✕
            </button>
          </form>

        </div>
      {% endfor %}
    </div>
  {% else %}
    <div style="border:2px solid #111;border-radius:16px;padding:14px;opacity:.75;">
      Aucun chat enregistré pour le moment.
    </div>
  {% endif %}

  <div style="margin-top:20px;display:flex;gap:12px;">
    <a class="lander-btn ghost" href="/upload">Nouvelle analyse</a>
    <a class="lander-btn" href="/">Accueil</a>
  </div>

</div>
{% endblock %}
